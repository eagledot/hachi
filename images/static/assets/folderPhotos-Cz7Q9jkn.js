var d=Object.defineProperty;var l=(n,t,e)=>t in n?d(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var i=(n,t,e)=>l(n,typeof t!="symbol"?t+"":t,e);import{L as c}from"./config-Tz74n_gY.js";/* empty css              */import{U as p,I as P,P as m,a}from"./photoFilter-DmxItXNa.js";import{q as g,c as f}from"./utils-cLygY5EC.js";import{P as u}from"./pagination-C2tzTPy9.js";class I{constructor(){i(this,"filteredPhotos",[]);i(this,"displayedPhotos",[]);i(this,"currentPhotoIndex",-1);i(this,"folderPath","");i(this,"folderName","");i(this,"uiService");i(this,"photoFilter");i(this,"paginationComponent");i(this,"queryToken",null);i(this,"currentPage",1);i(this,"PAGE_SIZE",100);this.init()}async init(){new c({title:"Folder Photos - Hachi",currentPage:"/folder-photos.html",showNavbar:!0}),this.initializeComponents(),this.uiService=new p("photo-grid-container"),this.extractFolderPath(),this.setupEventListeners(),await this.loadFolderPhotos()}initializeComponents(){P.initialize(),m.initialize("photo-grid-container",{loadingId:"loading-indicator",errorId:"error-display",noResultsId:"no-results-message",gridId:"photo-grid"}),this.photoFilter=new a({onFilterChange:o=>this.handleFilteredPhotosUpdate(o)});const t=document.getElementById("photo-filter-container");t&&(t.innerHTML=a.getTemplate("photo-filter"),this.photoFilter.initialize("photo-filter"));const e=document.getElementById("pagination-container");e&&(this.paginationComponent=new u({container:e,totalItems:0,itemsPerPage:this.PAGE_SIZE,initialPage:0,onPageChange:o=>this.handlePageChange(o)}))}extractFolderPath(){const e=new URLSearchParams(window.location.search).get("path");e?(this.folderPath=decodeURIComponent(e),this.folderName=this.getDisplayName(this.folderPath),this.updateHeader()):this.showError("No folder path specified")}getDisplayName(t){const e=t.split(/[/\\]/);return e[e.length-1]||t}updateHeader(){const t=document.getElementById("folder-name"),e=document.getElementById("folder-path");t&&(t.textContent=this.folderName),e&&(e.textContent=this.folderPath)}setupEventListeners(){const t=document.getElementById("back-btn");t&&t.addEventListener("click",()=>{window.location.href="/folders.html"}),this.uiService.setupEventListeners({onPhotoClick:e=>this.handlePhotoClick(e),onModalClose:()=>this.closeModal(),onModalNext:()=>this.nextPhoto(),onModalPrevious:()=>this.previousPhoto()})}async loadFolderPhotos(){var t;if(!this.folderPath){this.showError("No folder path specified");return}this.showLoading(!0),this.hideError();try{const e=this.folderPath.toString().toLowerCase().replace(/\//g,"|");if(!this.displayedPhotos.length){console.log("Fetching pagination info for:",e);const r=await g("resource_directory",e,this.PAGE_SIZE);(t=this.paginationComponent)==null||t.update({totalItems:r.n_matches,totalPages:r.n_pages}),console.log("Pagination Info:",r),this.queryToken=r.query_token||null}if(!this.queryToken)return;const o=await f(this.queryToken,this.currentPage-1);if(console.log("Fetched folder photos:",o),o&&o.meta_data&&Array.isArray(o.meta_data)){this.displayedPhotos=o.data_hash.map((h,s)=>({id:h,score:o.score[s]||0,metadata:o.meta_data[s]||{}})),console.log("Converted photos:",this.displayedPhotos),this.filteredPhotos=[...this.displayedPhotos];const r=document.getElementById("photo-filter-container");this.renderPhotos()}else throw new Error("Invalid response format")}catch(e){console.error("Error loading folder photos:",e),this.showError(`Failed to load photos: ${e instanceof Error?e.message:"Unknown error"}`)}finally{this.showLoading(!1)}}handlePageChange(t){this.currentPage=t+1,this.loadFolderPhotos(),window.scrollTo(0,0)}renderPhotos(){const t=document.getElementById("photo-grid-container"),e=document.getElementById("no-photos");if(!(!t||!e)){if(console.log("Photos inside renderPhotos",this.filteredPhotos.length),this.filteredPhotos.length===0){t.innerHTML="",e.classList.remove("hidden");return}e.classList.add("hidden"),this.uiService.updatePhotos(this.displayedPhotos)}}handleFilteredPhotosUpdate(t){console.log("Filtered photos updated:",t.length),this.filteredPhotos=t,this.renderPhotos()}handlePhotoClick(t){this.currentPhotoIndex=this.filteredPhotos.findIndex(e=>e.id===t.id),this.currentPhotoIndex!==-1&&this.openModal(t)}openModal(t){const e=this.currentPhotoIndex>0,o=this.currentPhotoIndex<this.filteredPhotos.length-1;this.uiService.showModal(t,e,o)}closeModal(){this.uiService.hideModal(),this.currentPhotoIndex=-1}nextPhoto(){if(this.currentPhotoIndex<this.filteredPhotos.length-1){this.currentPhotoIndex++;const t=this.filteredPhotos[this.currentPhotoIndex];this.openModal(t)}}previousPhoto(){if(this.currentPhotoIndex>0){this.currentPhotoIndex--;const t=this.filteredPhotos[this.currentPhotoIndex];this.openModal(t)}}showLoading(t){const e=document.getElementById("loading-indicator");e&&(t?(e.classList.remove("hidden"),e.classList.add("flex")):(e.classList.add("hidden"),e.classList.remove("flex")))}showError(t){const e=document.getElementById("error-message"),o=document.getElementById("error-text");e&&o&&(o.textContent=t,e.classList.remove("hidden"))}hideError(){const t=document.getElementById("error-message");t&&t.classList.add("hidden")}}const y=new I;window.folderPhotosApp=y;console.log("Folder photos page initialized");
