var c=Object.defineProperty;var g=(s,t,e)=>t in s?c(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var i=(s,t,e)=>g(s,typeof t!="symbol"?t+"":t,e);import{L as P,q as p,d as m,c as f}from"./utils-CWqqr369.js";/* empty css              */import{U as u,I,P as E}from"./photoGrid-21K76TKL.js";import{P as a}from"./photoFilter-BPDcR0DG.js";import{P as y}from"./pagination-TDJLyXTr.js";class w{constructor(){i(this,"filteredPhotos",[]);i(this,"displayedPhotos",[]);i(this,"currentPhotoIndex",-1);i(this,"folderPath","");i(this,"folderName","");i(this,"uiService");i(this,"photoFilter");i(this,"paginationComponent");i(this,"queryToken",null);i(this,"currentPage",1);i(this,"imageHeight",0);i(this,"imageWidth",0);i(this,"PAGE_SIZE",Math.floor(window.innerHeight/45));this.init()}findGallerySize(){const t=document.getElementById("photo-gallery"),e=t==null?void 0:t.clientHeight;console.log(`Photo gallery height: ${e}px`);const o=t==null?void 0:t.clientWidth,n=156,{rows:h,cols:r,tileWidth:d,tileHeight:l}=f(e,o,n);this.PAGE_SIZE=h*r,this.imageHeight=l-10,this.imageWidth=d-6,console.log(`Calculated results per page: ${this.PAGE_SIZE}`)}async init(){this.findGallerySize(),new P({title:"Folder Photos - Hachi",currentPage:"/folder-photos.html",showNavbar:!0}),this.initializeComponents(),this.uiService=new u("photo-grid-container",this.imageHeight,this.imageWidth,this.PAGE_SIZE),this.extractFolderPath(),this.setupEventListeners(),await this.loadFolderPhotos()}initializeComponents(){I.initialize(),E.initialize("photo-grid-container",{loadingId:"loading-indicator",errorId:"error-display",noResultsId:"no-results-message",gridId:"photo-grid"}),this.photoFilter=new a({onFilterChange:o=>this.handleFilteredPhotosUpdate(o)});const t=document.getElementById("photo-filter-container");t&&(t.innerHTML=a.getTemplate("photo-filter"),this.photoFilter.initialize("photo-filter"));const e=document.getElementById("pagination-container");e&&(this.paginationComponent=new y({container:e,totalItems:0,itemsPerPage:this.PAGE_SIZE,initialPage:0,onPageChange:o=>this.handlePageChange(o)}))}extractFolderPath(){const e=new URLSearchParams(window.location.search).get("path");e?(this.folderPath=decodeURIComponent(e),this.folderName=this.getDisplayName(this.folderPath),this.updateHeader()):this.showError("No folder path specified")}getDisplayName(t){const e=t.split(/[/\\]/);return e[e.length-1]||t}updateHeader(){const t=document.getElementById("folder-name"),e=document.getElementById("folder-path");t&&(t.textContent=this.folderName),e&&(e.textContent=this.folderPath)}setupEventListeners(){const t=document.getElementById("back-btn");t&&t.addEventListener("click",()=>{window.location.href="/folders.html"}),this.uiService.setupEventListeners({onPhotoClick:e=>this.handlePhotoClick(e),onModalClose:()=>this.closeModal(),onModalNext:()=>this.nextPhoto(),onModalPrevious:()=>this.previousPhoto()})}async loadFolderPhotos(){var t;if(!this.folderPath){this.showError("No folder path specified");return}this.hideError();try{const e=this.folderPath.toString().toLowerCase().replace(/\//g,"|");if(!this.displayedPhotos.length){this.showLoading(!0),console.log("Fetching pagination info for:",e);const n=await p("resource_directory",e,this.PAGE_SIZE);(t=this.paginationComponent)==null||t.update({totalItems:n.n_matches,totalPages:n.n_pages}),console.log("Pagination Info:",n),this.queryToken=n.query_token||null}if(!this.queryToken)return;const o=await m(this.queryToken,this.currentPage-1);if(console.log("Fetched folder photos:",o),o&&o.meta_data&&Array.isArray(o.meta_data)){this.displayedPhotos=o.data_hash.map((h,r)=>({id:h,score:o.score[r]||0,metadata:o.meta_data[r]||{}})),console.log("Converted photos:",this.displayedPhotos),this.filteredPhotos=[...this.displayedPhotos];const n=document.getElementById("photo-filter-container");this.renderPhotos()}else throw new Error("Invalid response format")}catch(e){console.error("Error loading folder photos:",e),this.showError(`Failed to load photos: ${e instanceof Error?e.message:"Unknown error"}`)}finally{this.showLoading(!1)}}handlePageChange(t){this.currentPage=t+1,this.loadFolderPhotos(),window.scrollTo(0,0)}renderPhotos(){const t=document.getElementById("photo-grid-container"),e=document.getElementById("no-photos");if(!(!t||!e)){if(console.log("Photos inside renderPhotos",this.filteredPhotos.length),this.filteredPhotos.length===0){t.innerHTML="",e.classList.remove("hidden");return}e.classList.add("hidden"),this.uiService.updatePhotos(this.displayedPhotos)}}handleFilteredPhotosUpdate(t){console.log("Filtered photos updated:",t.length),this.filteredPhotos=t,this.renderPhotos()}handlePhotoClick(t){this.currentPhotoIndex=this.filteredPhotos.findIndex(e=>e.id===t.id),this.currentPhotoIndex!==-1&&this.openModal(t)}openModal(t){const e=this.currentPhotoIndex>0,o=this.currentPhotoIndex<this.filteredPhotos.length-1;this.uiService.showModal(t,e,o)}closeModal(){this.uiService.hideModal(),this.currentPhotoIndex=-1}nextPhoto(){if(this.currentPhotoIndex<this.filteredPhotos.length-1){this.currentPhotoIndex++;const t=this.filteredPhotos[this.currentPhotoIndex];this.openModal(t)}}previousPhoto(){if(this.currentPhotoIndex>0){this.currentPhotoIndex--;const t=this.filteredPhotos[this.currentPhotoIndex];this.openModal(t)}}showLoading(t){const e=document.getElementById("loading-indicator");e&&(t?(e.classList.remove("hidden"),e.classList.add("flex")):(e.classList.add("hidden"),e.classList.remove("flex")))}showError(t){const e=document.getElementById("error-message"),o=document.getElementById("error-text");e&&o&&(o.textContent=t,e.classList.remove("hidden"))}hideError(){const t=document.getElementById("error-message");t&&t.classList.add("hidden")}}const x=new w;window.folderPhotosApp=x;console.log("Folder photos page initialized");
