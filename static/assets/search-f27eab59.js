import{S as Re,i as Be,s as Ge,H as He,e as h,a as I,D as Je,b as a,k as Le,d as C,f as c,E as Qe,l as U,y as Ve,A as Xe,g as D,G as We,v as le,r as Y,J,t as Q,m as ee,j as Ye,N as ie,c as oe,x as V,O as Ze,P as xe}from"./DarkMode-75e4b314.js";function ue(l,t,e){const n=l.slice();return n[54]=t[e],n[56]=e,n}function re(l,t,e){const n=l.slice();return n[57]=t[e],n}function ae(l,t,e){const n=l.slice();return n[60]=t[e],n[61]=t,n[56]=e,n}function fe(l){let t,e,n,i,r,s,u,f,w,p;return{c(){t=h("div"),e=h("br"),n=I(),i=h("input"),r=I(),s=h("button"),s.textContent="Start Indexing",u=I(),f=h("button"),f.textContent="Cancel",a(i,"type","text"),a(i,"class","bg-transparent w-72 focus:outline-none dark:text-white border-b border-black dark:border-white"),a(i,"placeholder","Provide absolute path to image directory."),a(s,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),a(f,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md")},m(m,_){C(m,t,_),c(t,e),c(t,n),c(t,i),l[33](i),J(i,l[8]),c(t,r),c(t,s),c(t,u),c(t,f),w||(p=[U(i,"input",l[34]),U(s,"click",l[29]),U(f,"click",l[35])],w=!0)},p(m,_){_[0]&256&&i.value!==m[8]&&J(i,m[8])},d(m){m&&D(t),l[33](null),w=!1,Y(p)}}}function pe(l){let t,e,n;return{c(){t=h("p"),t.textContent="Indexing in progress...please wait for it to finish.",e=I(),n=h("progress"),a(t,"class","dark:text-white"),a(n,"class","bg-gray-400 h-3 mt-2 w-full"),n.value=l[10],a(n,"max","1")},m(i,r){C(i,t,r),C(i,e,r),C(i,n,r)},p(i,r){r[0]&1024&&(n.value=i[10])},d(i){i&&D(t),i&&D(e),i&&D(n)}}}function de(l){let t;return{c(){t=h("div"),a(t,"class","flex-grow h-px my-5 bg-gray-500 dark:bg-white")},m(e,n){C(e,t,n)},d(e){e&&D(t)}}}function ce(l){let t,e,n,i,r,s,u,f,w,p,m=l[2],_=[];for(let d=0;d<m.length;d+=1)_[d]=_e(ae(l,m,d));return{c(){t=h("div"),e=h("div");for(let d=0;d<_.length;d+=1)_[d].c();n=I(),i=h("button"),i.textContent="Upload",r=I(),s=h("button"),s.textContent="Cancel",u=I(),f=h("div"),a(i,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),a(s,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),a(t,"class","flex flex-row place-content-center mt-10 mb-10 select-none mx-2"),a(f,"class","flex-grow h-px my-5 bg-gray-500 dark:bg-white")},m(d,S){C(d,t,S),c(t,e);for(let y=0;y<_.length;y+=1)_[y].m(e,null);c(e,n),c(e,i),c(e,r),c(e,s),C(d,u,S),C(d,f,S),w||(p=[U(i,"click",l[31]),U(s,"click",l[38])],w=!0)},p(d,S){if(S[0]&12){m=d[2];let y;for(y=0;y<m.length;y+=1){const K=ae(d,m,y);_[y]?_[y].p(K,S):(_[y]=_e(K),_[y].c(),_[y].m(e,n))}for(;y<_.length;y+=1)_[y].d(1);_.length=m.length}},d(d){d&&D(t),le(_,d),d&&D(u),d&&D(f),w=!1,Y(p)}}}function _e(l){let t,e,n,i,r=l[60].name+"",s,u,f,w,p;function m(){l[37].call(t,l[56])}return{c(){t=h("input"),e=I(),n=h("span"),i=h("p"),s=Q(r),u=I(),f=h("br"),a(t,"type","text"),a(t,"placeholder","enter unique Id"),a(i,"class","dark:text-white")},m(_,d){C(_,t,d),J(t,l[3][l[56]]),C(_,e,d),C(_,n,d),c(n,i),c(i,s),C(_,u,d),C(_,f,d),w||(p=U(t,"input",m),w=!0)},p(_,d){l=_,d[0]&8&&t.value!==l[3][l[56]]&&J(t,l[3][l[56]]),d[0]&4&&r!==(r=l[60].name+"")&&ee(s,r)},d(_){_&&D(t),_&&D(e),_&&D(n),_&&D(u),_&&D(f),w=!1,p()}}}function me(l){let t,e,n,i,r,s,u,f,w,p,m,_,d,S,y,K,M,N,E=l[16]&&be(l);return{c(){t=h("input"),e=I(),n=h("button"),n.textContent="Query All Images",i=I(),E&&E.c(),r=I(),s=h("p"),u=Q(l[11]),f=Q(" Images Indexed So far."),w=I(),p=h("div"),m=h("input"),_=I(),d=h("label"),S=Q("Displaying top "),y=Q(l[13]),K=Q(" images."),t.autofocus=!0,a(t,"class","bg-transparent focus:outline-none dark:text-white border-b border-black dark:border-white"),a(t,"placeholder","Search"),a(n,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 my-2 ml-2 rounded-md"),a(s,"class","dark:text-white"),a(m,"type","range"),a(m,"min","1"),a(m,"max","30"),a(m,"class","w-full"),a(d,"for","topk"),a(d,"class","dark:text-white"),a(p,"class","my-4")},m(g,v){C(g,t,v),l[39](t),J(t,l[6]),C(g,e,v),C(g,n,v),l[41](n),C(g,i,v),E&&E.m(g,v),C(g,r,v),C(g,s,v),c(s,u),c(s,f),C(g,w,v),C(g,p,v),c(p,m),l[44](m),J(m,l[13]),c(p,_),c(p,d),c(d,S),c(d,y),c(d,K),t.focus(),M||(N=[U(t,"keyup",l[23]),U(t,"keydown",l[25]),U(t,"input",l[40]),U(n,"click",l[22]),U(m,"change",l[24]),U(m,"change",l[45]),U(m,"input",l[45])],M=!0)},p(g,v){v[0]&64&&t.value!==g[6]&&J(t,g[6]),g[16]?E?E.p(g,v):(E=be(g),E.c(),E.m(r.parentNode,r)):E&&(E.d(1),E=null),v[0]&2048&&ee(u,g[11]),v[0]&8192&&J(m,g[13]),v[0]&8192&&ee(y,g[13])},d(g){g&&D(t),l[39](null),g&&D(e),g&&D(n),l[41](null),g&&D(i),E&&E.d(g),g&&D(r),g&&D(s),g&&D(w),g&&D(p),l[44](null),M=!1,Y(N)}}}function be(l){let t,e,n,i,r,s=l[15],u=[];for(let f=0;f<s.length;f+=1)u[f]=he(re(l,s,f));return{c(){t=h("div"),e=h("select");for(let f=0;f<u.length;f+=1)u[f].c();a(e,"size",n=l[15].length<10?l[15].length:10),l[17]===void 0&&Ye(()=>l[42].call(e))},m(f,w){C(f,t,w),c(t,e);for(let p=0;p<u.length;p+=1)u[p].m(e,null);ie(e,l[17]),l[43](e),i||(r=[U(e,"click",l[26]),U(e,"keyup",l[27]),U(e,"change",l[42])],i=!0)},p(f,w){if(w[0]&32768){s=f[15];let p;for(p=0;p<s.length;p+=1){const m=re(f,s,p);u[p]?u[p].p(m,w):(u[p]=he(m),u[p].c(),u[p].m(e,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=s.length}w[0]&32768&&n!==(n=f[15].length<10?f[15].length:10)&&a(e,"size",n),w[0]&131072&&ie(e,f[17])},d(f){f&&D(t),le(u,f),l[43](null),i=!1,Y(r)}}}function he(l){let t,e=l[57]+"",n,i,r;return{c(){t=h("option"),n=Q(e),i=I(),t.__value=r=l[57],t.value=t.__value},m(s,u){C(s,t,u),c(t,n),c(t,i)},p(s,u){u[0]&32768&&e!==(e=s[57]+"")&&ee(n,e),u[0]&32768&&r!==(r=s[57])&&(t.__value=r,t.value=t.__value)},d(s){s&&D(t)}}}function ge(l){let t,e,n,i,r;return{c(){t=h("a"),e=h("img"),i=I(),a(e,"class","h-auto rounded-lg shadow-xl"),oe(e.src,n=l[54])||a(e,"src",n),a(e,"alt","image"),a(t,"href",r="/api/get_full_image/"+l[5][l[56]]),a(t,"target","_blank"),a(t,"rel","noreferrer"),a(t,"class","rounded h-full text-grey-darkest no-underline shadow-md w-64")},m(s,u){C(s,t,u),c(t,e),c(t,i)},p(s,u){u[0]&16&&!oe(e.src,n=s[54])&&a(e,"src",n),u[0]&32&&r!==(r="/api/get_full_image/"+s[5][s[56]])&&a(t,"href",r)},d(s){s&&D(t)}}}function $e(l){let t,e,n,i,r,s,u,f,w,p,m,_,d,S,y,K,M,N,E,g,v,X,G;u=new He({});let j=l[9]&&fe(l),q=l[1]&&pe(l),O=(l[9]||l[1])&&de(),F=l[20]&&ce(l),P=l[12]&&l[11]>0&&me(l),H=l[4],T=[];for(let b=0;b<H.length;b+=1)T[b]=ge(ue(l,H,b));return{c(){t=h("div"),e=h("div"),n=h("button"),n.textContent="Add Image directory",i=I(),r=h("button"),r.textContent="Update Person Database",s=I(),Je(u.$$.fragment),f=I(),w=h("div"),p=h("div"),j&&j.c(),m=I(),q&&q.c(),_=I(),O&&O.c(),d=I(),S=h("input"),y=I(),F&&F.c(),K=I(),M=h("div"),N=h("div"),P&&P.c(),E=I(),g=h("div");for(let b=0;b<T.length;b+=1)T[b].c();a(n,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 mx-2 rounded-md"),a(r,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 mx-2 rounded-md"),a(e,"class","flex flex-row mt-10 justify-center"),a(w,"class","flex flex-row place-content-center mb-10 select-none mx-2"),a(S,"type","file"),S.multiple=!0,Le(S,"display","none"),a(S,"accept","image/png, image/jpeg, image/jpg"),a(M,"class","flex flex-row place-content-center mb-10 select-none mx-2"),a(g,"class","flex flex-wrap gap-6 p-4 sm:p-12 px-auto justify-center"),a(t,"class","overflow-y-auto min-h-screen dark:bg-gray-600 p-2")},m(b,R){C(b,t,R),c(t,e),c(e,n),c(e,i),c(e,r),c(e,s),Qe(u,e,null),c(t,f),c(t,w),c(w,p),j&&j.m(p,null),c(p,m),q&&q.m(p,null),c(t,_),O&&O.m(t,null),c(t,d),c(t,S),l[36](S),c(t,y),F&&F.m(t,null),c(t,K),c(t,M),c(M,N),P&&P.m(N,null),c(t,E),c(t,g);for(let A=0;A<T.length;A+=1)T[A].m(g,null);v=!0,X||(G=[U(n,"click",l[28]),U(r,"click",l[32]),U(S,"change",l[30])],X=!0)},p(b,R){if(b[9]?j?j.p(b,R):(j=fe(b),j.c(),j.m(p,m)):j&&(j.d(1),j=null),b[1]?q?q.p(b,R):(q=pe(b),q.c(),q.m(p,null)):q&&(q.d(1),q=null),b[9]||b[1]?O||(O=de(),O.c(),O.m(t,d)):O&&(O.d(1),O=null),b[20]?F?F.p(b,R):(F=ce(b),F.c(),F.m(t,K)):F&&(F.d(1),F=null),b[12]&&b[11]>0?P?P.p(b,R):(P=me(b),P.c(),P.m(N,null)):P&&(P.d(1),P=null),R[0]&48){H=b[4];let A;for(A=0;A<H.length;A+=1){const W=ue(b,H,A);T[A]?T[A].p(W,R):(T[A]=ge(W),T[A].c(),T[A].m(g,null))}for(;A<T.length;A+=1)T[A].d(1);T.length=H.length}},i(b){v||(Ve(u.$$.fragment,b),v=!0)},o(b){Xe(u.$$.fragment,b),v=!1},d(b){b&&D(t),We(u),j&&j.d(),q&&q.d(),O&&O.d(),l[36](null),F&&F.d(),P&&P.d(),le(T,b),X=!1,Y(G)}}}let et=100;const tt="/api";async function lt(l,t){let e=new FormData;e.append("mimetype",l.type),e.append("id",t),e.append("imagedata",l);const i=await fetch("/api/updateDatabase",{method:"POST",body:e});if(i.ok){const r=await i.json();alert(r.reason)}else throw new Error(i)}function nt(l,t,e){let n=[],i=[],r=[],s,u="",f=0,w,p,m,_=!1,d="0",S=!1,y=0,K=!0;function M(){const o=i.map((k,z)=>({i:z,value:i[z]}));o.sort((k,z)=>k.value>z.value?-1:k.value<z.value?1:0),i=o.map(k=>k.value),e(4,n=o.map(k=>n[k.i])),e(5,r=o.map(k=>r[k.i]))}let N=3;async function E(){let o=N;if(w=new FormData,!u)return;if(w.append("text_query",u),w.append("topk",o.toString()),f==0&&(e(4,n=[]),e(5,r=[]),i=[],w.append("query_start","true"),e(0,s.disabled=!0,s)),f==et){console.log("Max limit reached. Ending query."),f=0,e(0,s.disabled=!1,s);return}const k=tt+"/search/image";let z=await fetch(k,{method:"POST",body:w});if(!z.ok)throw e(0,s.disabled=!1,s),new Error(z);let te=z.body.getReader(),ze=await new ReadableStream({start(ne){return se();function se(){return te.read().then(({done:Ke,value:Me})=>{if(Ke){ne.close();return}return ne.enqueue(Me),se()})}}}),$=await(await new Response(ze)).json();if($.query_completed==!0){console.log("Stream completed"),f=0,e(0,s.disabled=!1,s);return}r.push($.local_hash),n.push($.data),i.push(Number($.score)),M(),f+=1,E()}function g(o){o.key==="Enter"&&s.disabled==!1&&E()}let v;function X(){console.log("topk: ",N),E()}let G=[],j=!1,q,O=!1,F,P;async function H(){let o=await fetch("/api/faceIds");if(o.ok){let k=await o.json();e(15,G=k.face_ids.sort())}else throw new Error(o)}async function T(o){o.key==="@"?(e(16,j=!0),O=!1,await H(),P.focus(),e(17,q=G[0]),console.log("faces: ",G)):(o.key==="Enter"||o.key===" ")&&e(16,j=!1)}function b(){O||(e(6,u=u+q),O=!0),F.focus(),e(16,j=!1)}function R(o){o.key==="Enter"&&b(),(o.key==="Escape"||o.key==="Backspace")&&(e(16,j=!1),F.focus())}function A(){e(9,_=!0)}async function W(){let o=await fetch("/api/getIndexCount/image");if(o.ok){let k=await o.json();e(11,y=k.index_count)}else throw new Error(o)}async function we(){console.log("adding image directory "+m),e(9,_=!1);let o=new FormData;o.append("image_directory_path",m);let k=await fetch("/api/indexImageDir",{method:"POST",body:o});if(k.ok)(await k.json()).success==!0&&(s&&e(0,s.disabled=!1,s),alert("Index Updated Successfully."),e(1,S=!1),await W());else throw new Error(k)}W();let ke=new EventSource("/api/imageIndexProgress");ke.onmessage=o=>{e(1,S=!0),console.log("Got some data: "+o.data);let k=o.data;e(10,d=k),d=="1"&&e(1,S=!1)};let Z=!1,x,B,L=[];function ye(){e(2,B=[]),e(3,L=[]),e(2,B=this.files),console.log(B.length,"Files Selected");for(let o=0;o<B.length;o++){let k=B[o];console.log("mimetype: ",k.type),L.push("")}e(20,Z=!0)}async function ve(o){o.preventDefault();for(let k=0;k<B.length;k++){let z=L[k],te=B[k];if(z===""){alert("face ids cannot be empty");return}await lt(te,z)}e(20,Z=!1)}const Ie=()=>{x.click()};function Ce(o){V[o?"unshift":"push"](()=>{p=o,e(7,p)})}function De(){m=this.value,e(8,m)}const Se=()=>{e(9,_=!1)};function Ee(o){V[o?"unshift":"push"](()=>{x=o,e(21,x)})}function je(o){L[o]=this.value,e(3,L)}const qe=()=>{e(20,Z=!1)};function Fe(o){V[o?"unshift":"push"](()=>{F=o,e(18,F)})}function Pe(){u=this.value,e(6,u)}function Ue(o){V[o?"unshift":"push"](()=>{s=o,e(0,s)})}function Ae(){q=Ze(this),e(17,q)}function Oe(o){V[o?"unshift":"push"](()=>{P=o,e(19,P),e(15,G)})}function Te(o){V[o?"unshift":"push"](()=>{v=o,e(14,v),e(0,s)})}function Ne(){N=xe(this.value),e(13,N)}return l.$$.update=()=>{l.$$.dirty[0]&2&&e(12,K=!S),l.$$.dirty[0]&1&&s&&e(14,v.disabled=s.disabled,v),l.$$.dirty[0]&12&&(console.log(B),console.log(L))},[s,S,B,L,n,r,u,p,m,_,d,y,K,N,v,G,j,q,F,P,Z,x,E,g,X,T,b,R,A,we,ye,ve,Ie,Ce,De,Se,Ee,je,qe,Fe,Pe,Ue,Ae,Oe,Te,Ne]}class st extends Re{constructor(t){super(),Be(this,t,nt,$e,Ge,{},null,[-1,-1])}}new st({target:document.getElementById("app")});
