import{S as Be,i as Ge,s as Le,e as b,a as k,t as H,b as d,k as Qe,d as v,f as p,I as X,l as q,m as ne,n as fe,g as I,v as ie,r as x,j as Ve,M as re,c as ae,x as Y,N as Xe,O as He}from"./index-ad9718b8.js";function pe(t,l,e){const n=t.slice();return n[54]=l[e],n[56]=e,n}function ce(t,l,e){const n=t.slice();return n[57]=l[e],n}function de(t,l,e){const n=t.slice();return n[60]=l[e],n[61]=l,n[56]=e,n}function _e(t){let l,e,n,o,r,s,f,c,g,m;return{c(){l=b("div"),e=b("br"),n=k(),o=b("input"),r=k(),s=b("button"),s.textContent="Start Indexing",f=k(),c=b("button"),c.textContent="Cancel",d(o,"type","text"),d(o,"class","bg-transparent focus:outline-none text-white border-b "),d(o,"placeholder","Provide absolute path to image directory."),d(s,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),d(c,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md")},m(_,i){v(_,l,i),p(l,e),p(l,n),p(l,o),t[33](o),X(o,t[8]),p(l,r),p(l,s),p(l,f),p(l,c),g||(m=[q(o,"input",t[34]),q(s,"click",t[29]),q(c,"click",t[35])],g=!0)},p(_,i){i[0]&256&&o.value!==_[8]&&X(o,_[8])},d(_){_&&I(l),t[33](null),g=!1,x(m)}}}function me(t){let l,e,n;return{c(){l=b("p"),l.textContent="Indexing in progress...please wait for it to finish.",e=k(),n=b("progress"),d(n,"class","bg-gray-400 h-3 mt-2 w-full"),n.value=t[10],d(n,"max","1")},m(o,r){v(o,l,r),v(o,e,r),v(o,n,r)},p(o,r){r[0]&1024&&(n.value=o[10])},d(o){o&&I(l),o&&I(e),o&&I(n)}}}function be(t){let l;return{c(){l=b("div"),d(l,"class","flex-grow h-px my-5 bg-white")},m(e,n){v(e,l,n)},d(e){e&&I(l)}}}function he(t){let l,e,n,o,r,s,f,c,g,m,_=t[2],i=[];for(let a=0;a<_.length;a+=1)i[a]=ge(de(t,_,a));return{c(){l=b("div"),e=b("div");for(let a=0;a<i.length;a+=1)i[a].c();n=k(),o=b("button"),o.textContent="Upload",r=k(),s=b("button"),s.textContent="Cancel",f=k(),c=b("div"),d(o,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),d(s,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),d(l,"class","flex flex-row place-content-center mt-10 mb-10 select-none mx-2"),d(c,"class","flex-grow h-px my-5 bg-white")},m(a,S){v(a,l,S),p(l,e);for(let C=0;C<i.length;C+=1)i[C].m(e,null);p(e,n),p(e,o),p(e,r),p(e,s),v(a,f,S),v(a,c,S),g||(m=[q(o,"click",t[31]),q(s,"click",t[38])],g=!0)},p(a,S){if(S[0]&12){_=a[2];let C;for(C=0;C<_.length;C+=1){const M=de(a,_,C);i[C]?i[C].p(M,S):(i[C]=ge(M),i[C].c(),i[C].m(e,n))}for(;C<i.length;C+=1)i[C].d(1);i.length=_.length}},d(a){a&&I(l),ie(i,a),a&&I(f),a&&I(c),g=!1,x(m)}}}function ge(t){let l,e,n,o,r=t[60].name+"",s,f,c,g,m;function _(){t[37].call(l,t[56])}return{c(){l=b("input"),e=k(),n=b("span"),o=b("p"),s=H(r),f=k(),c=b("br"),d(l,"type","text"),d(l,"placeholder","enter unique Id")},m(i,a){v(i,l,a),X(l,t[3][t[56]]),v(i,e,a),v(i,n,a),p(n,o),p(o,s),v(i,f,a),v(i,c,a),g||(m=q(l,"input",_),g=!0)},p(i,a){t=i,a[0]&8&&l.value!==t[3][t[56]]&&X(l,t[3][t[56]]),a[0]&4&&r!==(r=t[60].name+"")&&ne(s,r)},d(i){i&&I(l),i&&I(e),i&&I(n),i&&I(f),i&&I(c),g=!1,m()}}}function we(t){let l,e,n,o,r,s,f,c,g,m,_=t[16]&&ke(t);return{c(){l=b("input"),e=k(),n=b("button"),n.textContent="Query All Images",o=k(),_&&_.c(),r=k(),s=b("p"),f=H(t[11]),c=H(" Images Indexed So far."),l.autofocus=!0,d(l,"class","bg-transparent focus:outline-none text-white border-b "),d(l,"placeholder","Search"),d(n,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md")},m(i,a){v(i,l,a),t[39](l),X(l,t[6]),v(i,e,a),v(i,n,a),t[41](n),v(i,o,a),_&&_.m(i,a),v(i,r,a),v(i,s,a),p(s,f),p(s,c),l.focus(),g||(m=[q(l,"keyup",t[23]),q(l,"keydown",t[25]),q(l,"input",t[40]),q(n,"click",t[22])],g=!0)},p(i,a){a[0]&64&&l.value!==i[6]&&X(l,i[6]),i[16]?_?_.p(i,a):(_=ke(i),_.c(),_.m(r.parentNode,r)):_&&(_.d(1),_=null),a[0]&2048&&ne(f,i[11])},d(i){i&&I(l),t[39](null),i&&I(e),i&&I(n),t[41](null),i&&I(o),_&&_.d(i),i&&I(r),i&&I(s),g=!1,x(m)}}}function ke(t){let l,e,n,o,r,s=t[15],f=[];for(let c=0;c<s.length;c+=1)f[c]=ye(ce(t,s,c));return{c(){l=b("div"),e=b("select");for(let c=0;c<f.length;c+=1)f[c].c();d(e,"size",n=t[15].length<10?t[15].length:10),t[17]===void 0&&Ve(()=>t[42].call(e))},m(c,g){v(c,l,g),p(l,e);for(let m=0;m<f.length;m+=1)f[m].m(e,null);re(e,t[17]),t[43](e),o||(r=[q(e,"click",t[26]),q(e,"keyup",t[27]),q(e,"change",t[42])],o=!0)},p(c,g){if(g[0]&32768){s=c[15];let m;for(m=0;m<s.length;m+=1){const _=ce(c,s,m);f[m]?f[m].p(_,g):(f[m]=ye(_),f[m].c(),f[m].m(e,null))}for(;m<f.length;m+=1)f[m].d(1);f.length=s.length}g[0]&32768&&n!==(n=c[15].length<10?c[15].length:10)&&d(e,"size",n),g[0]&131072&&re(e,c[17])},d(c){c&&I(l),ie(f,c),t[43](null),o=!1,x(r)}}}function ye(t){let l,e=t[57]+"",n,o,r;return{c(){l=b("option"),n=H(e),o=k(),l.__value=r=t[57],l.value=l.__value,d(l,"class","bg-white")},m(s,f){v(s,l,f),p(l,n),p(l,o)},p(s,f){f[0]&32768&&e!==(e=s[57]+"")&&ne(n,e),f[0]&32768&&r!==(r=s[57])&&(l.__value=r,l.value=l.__value)},d(s){s&&I(l)}}}function ve(t){let l,e,n,o,r;return{c(){l=b("a"),e=b("img"),o=k(),d(e,"class","h-auto rounded-lg shadow-xl"),ae(e.src,n=t[54])||d(e,"src",n),d(e,"alt","image"),d(l,"href",r="/api/get_full_image/"+t[5][t[56]]),d(l,"target","_blank"),d(l,"rel","noreferrer"),d(l,"class","rounded h-full text-grey-darkest no-underline shadow-md w-64")},m(s,f){v(s,l,f),p(l,e),p(l,o)},p(s,f){f[0]&16&&!ae(e.src,n=s[54])&&d(e,"src",n),f[0]&32&&r!==(r="/api/get_full_image/"+s[5][s[56]])&&d(l,"href",r)},d(s){s&&I(l)}}}function Je(t){let l,e,n,o,r,s,f,c,g,m,_,i,a,S,C,M,J,N,R,B,j,$,z,G,L,W,Q,K,Z,ee,F=t[9]&&_e(t),U=t[1]&&me(t),T=(t[9]||t[1])&&be(),P=t[20]&&he(t),O=t[12]&&t[11]>0&&we(t),V=t[4],E=[];for(let h=0;h<V.length;h+=1)E[h]=ve(pe(t,V,h));return{c(){l=b("div"),e=b("div"),n=b("button"),n.textContent="Add Image directory",o=k(),r=b("button"),r.textContent="Update Person Database",s=k(),f=b("br"),c=k(),g=b("div"),m=b("div"),F&&F.c(),_=k(),U&&U.c(),i=k(),T&&T.c(),a=k(),S=b("input"),C=k(),P&&P.c(),M=k(),J=b("div"),N=b("div"),O&&O.c(),R=k(),B=b("div"),j=b("input"),$=k(),z=b("label"),G=H("Displaying top "),L=H(t[13]),W=H(" images."),Q=k(),K=b("div");for(let h=0;h<E.length;h+=1)E[h].c();d(n,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),d(r,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),d(e,"class","flex flex-row mt-10 place-content-center"),d(g,"class","flex flex-row place-content-center mb-10 select-none mx-2"),d(S,"type","file"),S.multiple=!0,Qe(S,"display","none"),d(S,"accept","image/png, image/jpeg, image/jpg"),d(j,"type","range"),d(j,"min","1"),d(j,"max","30"),d(j,"class","w-full"),d(z,"for","topk"),d(z,"class","text-white"),d(B,"class","my-4"),d(J,"class","flex flex-row place-content-center mb-10 select-none mx-2"),d(K,"class","flex flex-wrap gap-6 p-4 sm:p-12 px-auto justify-center"),d(l,"class","overflow-y-auto min-h-screen bg-gray-600")},m(h,D){v(h,l,D),p(l,e),p(e,n),p(e,o),p(e,r),p(e,s),p(e,f),p(l,c),p(l,g),p(g,m),F&&F.m(m,null),p(m,_),U&&U.m(m,null),p(l,i),T&&T.m(l,null),p(l,a),p(l,S),t[36](S),p(l,C),P&&P.m(l,null),p(l,M),p(l,J),p(J,N),O&&O.m(N,null),p(N,R),p(N,B),p(B,j),t[44](j),X(j,t[13]),p(B,$),p(B,z),p(z,G),p(z,L),p(z,W),p(l,Q),p(l,K);for(let y=0;y<E.length;y+=1)E[y].m(K,null);Z||(ee=[q(n,"click",t[28]),q(r,"click",t[32]),q(S,"change",t[30]),q(j,"change",t[24]),q(j,"change",t[45]),q(j,"input",t[45])],Z=!0)},p(h,D){if(h[9]?F?F.p(h,D):(F=_e(h),F.c(),F.m(m,_)):F&&(F.d(1),F=null),h[1]?U?U.p(h,D):(U=me(h),U.c(),U.m(m,null)):U&&(U.d(1),U=null),h[9]||h[1]?T||(T=be(),T.c(),T.m(l,a)):T&&(T.d(1),T=null),h[20]?P?P.p(h,D):(P=he(h),P.c(),P.m(l,M)):P&&(P.d(1),P=null),h[12]&&h[11]>0?O?O.p(h,D):(O=we(h),O.c(),O.m(N,R)):O&&(O.d(1),O=null),D[0]&8192&&X(j,h[13]),D[0]&8192&&ne(L,h[13]),D[0]&48){V=h[4];let y;for(y=0;y<V.length;y+=1){const le=pe(h,V,y);E[y]?E[y].p(le,D):(E[y]=ve(le),E[y].c(),E[y].m(K,null))}for(;y<E.length;y+=1)E[y].d(1);E.length=V.length}},i:fe,o:fe,d(h){h&&I(l),F&&F.d(),U&&U.d(),T&&T.d(),t[36](null),P&&P.d(),O&&O.d(),t[44](null),ie(E,h),Z=!1,x(ee)}}}let We=100;const Ye="/api";async function Ze(t,l){let e=new FormData;e.append("mimetype",t.type),e.append("id",l),e.append("imagedata",t);const o=await fetch("/api/updateDatabase",{method:"POST",body:e});if(o.ok){const r=await o.json();alert(r.reason)}else throw new Error(o)}function xe(t,l,e){let n=[],o=[],r=[],s,f="",c=0,g,m,_,i=!1,a="0",S=!1,C=0,M=!0;function J(){const u=o.map((w,A)=>({i:A,value:o[A]}));u.sort((w,A)=>w.value>A.value?-1:w.value<A.value?1:0),o=u.map(w=>w.value),e(4,n=u.map(w=>n[w.i])),e(5,r=u.map(w=>r[w.i]))}let N=3;async function R(){let u=N;if(g=new FormData,!f)return;if(g.append("text_query",f),g.append("topk",u.toString()),c==0&&(e(4,n=[]),e(5,r=[]),o=[],g.append("query_start","true"),e(0,s.disabled=!0,s)),c==We){console.log("Max limit reached. Ending query."),c=0,e(0,s.disabled=!1,s);return}const w=Ye+"/search/image";let A=await fetch(w,{method:"POST",body:g});if(!A.ok)throw e(0,s.disabled=!1,s),new Error(A);let se=A.body.getReader(),Ke=await new ReadableStream({start(oe){return ue();function ue(){return se.read().then(({done:Me,value:Re})=>{if(Me){oe.close();return}return oe.enqueue(Re),ue()})}}}),te=await(await new Response(Ke)).json();if(te.query_completed==!0){console.log("Stream completed"),c=0,e(0,s.disabled=!1,s);return}r.push(te.local_hash),n.push(te.data),o.push(Number(te.score)),J(),c+=1,R()}function B(u){u.key==="Enter"&&s.disabled==!1&&R()}let j;function $(){console.log("topk: ",N),R()}let z=[],G=!1,L,W=!1,Q,K;async function Z(){let u=await fetch("/api/faceIds");if(u.ok){let w=await u.json();e(15,z=w.face_ids.sort())}else throw new Error(u)}async function ee(u){u.key==="@"?(e(16,G=!0),W=!1,await Z(),K.focus(),console.log("faces: ",z)):(u.key==="Enter"||u.key===" ")&&e(16,G=!1)}function F(){W||(e(6,f=f+L),W=!0),Q.focus(),e(16,G=!1)}function U(u){u.key==="Enter"&&F(),(u.key==="Escape"||u.key==="Backspace")&&(e(16,G=!1),Q.focus())}function T(){e(9,i=!0)}async function P(){let u=await fetch("/api/getIndexCount/image");if(u.ok){let w=await u.json();e(11,C=w.index_count)}else throw new Error(u)}async function O(){console.log("adding image directory "+_),e(9,i=!1);let u=new FormData;u.append("image_directory_path",_);let w=await fetch("/api/indexImageDir",{method:"POST",body:u});if(w.ok)(await w.json()).success==!0&&(s&&e(0,s.disabled=!1,s),alert("Index Updated Successfully."),e(1,S=!1),await P());else throw new Error(w)}P();let V=new EventSource("/api/imageIndexProgress");V.onmessage=u=>{e(1,S=!0),console.log("Got some data: "+u.data);let w=u.data;e(10,a=w),a=="1"&&e(1,S=!1)};let E=!1,h,D,y=[];function le(){e(2,D=[]),e(3,y=[]),e(2,D=this.files),console.log(D.length,"Files Selected");for(let u=0;u<D.length;u++){let w=D[u];console.log("mimetype: ",w.type),y.push("")}e(20,E=!0)}async function Ie(u){u.preventDefault();for(let w=0;w<D.length;w++){let A=y[w],se=D[w];if(A===""){alert("face ids cannot be empty");return}await Ze(se,A)}e(20,E=!1)}const Ce=()=>{h.click()};function Se(u){Y[u?"unshift":"push"](()=>{m=u,e(7,m)})}function De(){_=this.value,e(8,_)}const Ee=()=>{e(9,i=!1)};function qe(u){Y[u?"unshift":"push"](()=>{h=u,e(21,h)})}function je(u){y[u]=this.value,e(3,y)}const Fe=()=>{e(20,E=!1)};function Pe(u){Y[u?"unshift":"push"](()=>{Q=u,e(18,Q)})}function Ue(){f=this.value,e(6,f)}function Oe(u){Y[u?"unshift":"push"](()=>{s=u,e(0,s)})}function Te(){L=Xe(this),e(17,L)}function Ae(u){Y[u?"unshift":"push"](()=>{K=u,e(19,K),e(15,z)})}function Ne(u){Y[u?"unshift":"push"](()=>{j=u,e(14,j),e(0,s)})}function ze(){N=He(this.value),e(13,N)}return t.$$.update=()=>{t.$$.dirty[0]&2&&e(12,M=!S),t.$$.dirty[0]&1&&s&&e(14,j.disabled=s.disabled,j),t.$$.dirty[0]&12&&(console.log(D),console.log(y))},[s,S,D,y,n,r,f,m,_,i,a,C,M,N,j,z,G,L,Q,K,E,h,R,B,$,ee,F,U,T,O,le,Ie,Ce,Se,De,Ee,qe,je,Fe,Pe,Ue,Oe,Te,Ae,Ne,ze]}class $e extends Be{constructor(l){super(),Ge(this,l,xe,Je,Le,{},null,[-1,-1])}}new $e({target:document.getElementById("app")});
