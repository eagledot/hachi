import{S as Be,i as Ge,s as Le,e as b,a as I,b as d,k as Qe,d as C,f as a,l as U,n as ie,g as S,v as le,r as H,I as L,t as V,m as $,j as Ve,M as oe,c as ue,x as X,N as Xe,O as He}from"./index-ad9718b8.js";function fe(t,l,e){const n=t.slice();return n[54]=l[e],n[56]=e,n}function re(t,l,e){const n=t.slice();return n[57]=l[e],n}function ae(t,l,e){const n=t.slice();return n[60]=l[e],n[61]=l,n[56]=e,n}function pe(t){let l,e,n,i,f,s,u,r,g,p;return{c(){l=b("div"),e=b("br"),n=I(),i=b("input"),f=I(),s=b("button"),s.textContent="Start Indexing",u=I(),r=b("button"),r.textContent="Cancel",d(i,"type","text"),d(i,"class","bg-transparent focus:outline-none text-white border-b "),d(i,"placeholder","Provide absolute path to image directory."),d(s,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),d(r,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md")},m(m,_){C(m,l,_),a(l,e),a(l,n),a(l,i),t[33](i),L(i,t[8]),a(l,f),a(l,s),a(l,u),a(l,r),g||(p=[U(i,"input",t[34]),U(s,"click",t[29]),U(r,"click",t[35])],g=!0)},p(m,_){_[0]&256&&i.value!==m[8]&&L(i,m[8])},d(m){m&&S(l),t[33](null),g=!1,H(p)}}}function ce(t){let l,e,n;return{c(){l=b("p"),l.textContent="Indexing in progress...please wait for it to finish.",e=I(),n=b("progress"),d(n,"class","bg-gray-400 h-3 mt-2 w-full"),n.value=t[10],d(n,"max","1")},m(i,f){C(i,l,f),C(i,e,f),C(i,n,f)},p(i,f){f[0]&1024&&(n.value=i[10])},d(i){i&&S(l),i&&S(e),i&&S(n)}}}function de(t){let l;return{c(){l=b("div"),d(l,"class","flex-grow h-px my-5 bg-white")},m(e,n){C(e,l,n)},d(e){e&&S(l)}}}function _e(t){let l,e,n,i,f,s,u,r,g,p,m=t[2],_=[];for(let c=0;c<m.length;c+=1)_[c]=me(ae(t,m,c));return{c(){l=b("div"),e=b("div");for(let c=0;c<_.length;c+=1)_[c].c();n=I(),i=b("button"),i.textContent="Upload",f=I(),s=b("button"),s.textContent="Cancel",u=I(),r=b("div"),d(i,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),d(s,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),d(l,"class","flex flex-row place-content-center mt-10 mb-10 select-none mx-2"),d(r,"class","flex-grow h-px my-5 bg-white")},m(c,D){C(c,l,D),a(l,e);for(let y=0;y<_.length;y+=1)_[y].m(e,null);a(e,n),a(e,i),a(e,f),a(e,s),C(c,u,D),C(c,r,D),g||(p=[U(i,"click",t[31]),U(s,"click",t[38])],g=!0)},p(c,D){if(D[0]&12){m=c[2];let y;for(y=0;y<m.length;y+=1){const K=ae(c,m,y);_[y]?_[y].p(K,D):(_[y]=me(K),_[y].c(),_[y].m(e,n))}for(;y<_.length;y+=1)_[y].d(1);_.length=m.length}},d(c){c&&S(l),le(_,c),c&&S(u),c&&S(r),g=!1,H(p)}}}function me(t){let l,e,n,i,f=t[60].name+"",s,u,r,g,p;function m(){t[37].call(l,t[56])}return{c(){l=b("input"),e=I(),n=b("span"),i=b("p"),s=V(f),u=I(),r=b("br"),d(l,"type","text"),d(l,"placeholder","enter unique Id")},m(_,c){C(_,l,c),L(l,t[3][t[56]]),C(_,e,c),C(_,n,c),a(n,i),a(i,s),C(_,u,c),C(_,r,c),g||(p=U(l,"input",m),g=!0)},p(_,c){t=_,c[0]&8&&l.value!==t[3][t[56]]&&L(l,t[3][t[56]]),c[0]&4&&f!==(f=t[60].name+"")&&$(s,f)},d(_){_&&S(l),_&&S(e),_&&S(n),_&&S(u),_&&S(r),g=!1,p()}}}function be(t){let l,e,n,i,f,s,u,r,g,p,m,_,c,D,y,K,B,N,E=t[16]&&he(t);return{c(){l=b("input"),e=I(),n=b("button"),n.textContent="Query All Images",i=I(),E&&E.c(),f=I(),s=b("p"),u=V(t[11]),r=V(" Images Indexed So far."),g=I(),p=b("div"),m=b("input"),_=I(),c=b("label"),D=V("Displaying top "),y=V(t[13]),K=V(" images."),l.autofocus=!0,d(l,"class","bg-transparent focus:outline-none text-white border-b "),d(l,"placeholder","Search"),d(n,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),d(m,"type","range"),d(m,"min","1"),d(m,"max","30"),d(m,"class","w-full"),d(c,"for","topk"),d(c,"class","text-white"),d(p,"class","my-4")},m(h,v){C(h,l,v),t[39](l),L(l,t[6]),C(h,e,v),C(h,n,v),t[41](n),C(h,i,v),E&&E.m(h,v),C(h,f,v),C(h,s,v),a(s,u),a(s,r),C(h,g,v),C(h,p,v),a(p,m),t[44](m),L(m,t[13]),a(p,_),a(p,c),a(c,D),a(c,y),a(c,K),l.focus(),B||(N=[U(l,"keyup",t[23]),U(l,"keydown",t[25]),U(l,"input",t[40]),U(n,"click",t[22]),U(m,"change",t[24]),U(m,"change",t[45]),U(m,"input",t[45])],B=!0)},p(h,v){v[0]&64&&l.value!==h[6]&&L(l,h[6]),h[16]?E?E.p(h,v):(E=he(h),E.c(),E.m(f.parentNode,f)):E&&(E.d(1),E=null),v[0]&2048&&$(u,h[11]),v[0]&8192&&L(m,h[13]),v[0]&8192&&$(y,h[13])},d(h){h&&S(l),t[39](null),h&&S(e),h&&S(n),t[41](null),h&&S(i),E&&E.d(h),h&&S(f),h&&S(s),h&&S(g),h&&S(p),t[44](null),B=!1,H(N)}}}function he(t){let l,e,n,i,f,s=t[15],u=[];for(let r=0;r<s.length;r+=1)u[r]=ge(re(t,s,r));return{c(){l=b("div"),e=b("select");for(let r=0;r<u.length;r+=1)u[r].c();d(e,"size",n=t[15].length<10?t[15].length:10),t[17]===void 0&&Ve(()=>t[42].call(e))},m(r,g){C(r,l,g),a(l,e);for(let p=0;p<u.length;p+=1)u[p].m(e,null);oe(e,t[17]),t[43](e),i||(f=[U(e,"click",t[26]),U(e,"keyup",t[27]),U(e,"change",t[42])],i=!0)},p(r,g){if(g[0]&32768){s=r[15];let p;for(p=0;p<s.length;p+=1){const m=re(r,s,p);u[p]?u[p].p(m,g):(u[p]=ge(m),u[p].c(),u[p].m(e,null))}for(;p<u.length;p+=1)u[p].d(1);u.length=s.length}g[0]&32768&&n!==(n=r[15].length<10?r[15].length:10)&&d(e,"size",n),g[0]&131072&&oe(e,r[17])},d(r){r&&S(l),le(u,r),t[43](null),i=!1,H(f)}}}function ge(t){let l,e=t[57]+"",n,i,f;return{c(){l=b("option"),n=V(e),i=I(),l.__value=f=t[57],l.value=l.__value,d(l,"class","bg-white")},m(s,u){C(s,l,u),a(l,n),a(l,i)},p(s,u){u[0]&32768&&e!==(e=s[57]+"")&&$(n,e),u[0]&32768&&f!==(f=s[57])&&(l.__value=f,l.value=l.__value)},d(s){s&&S(l)}}}function we(t){let l,e,n,i,f;return{c(){l=b("a"),e=b("img"),i=I(),d(e,"class","h-auto rounded-lg shadow-xl"),ue(e.src,n=t[54])||d(e,"src",n),d(e,"alt","image"),d(l,"href",f="/api/get_full_image/"+t[5][t[56]]),d(l,"target","_blank"),d(l,"rel","noreferrer"),d(l,"class","rounded h-full text-grey-darkest no-underline shadow-md w-64")},m(s,u){C(s,l,u),a(l,e),a(l,i)},p(s,u){u[0]&16&&!ue(e.src,n=s[54])&&d(e,"src",n),u[0]&32&&f!==(f="/api/get_full_image/"+s[5][s[56]])&&d(l,"href",f)},d(s){s&&S(l)}}}function Je(t){let l,e,n,i,f,s,u,r,g,p,m,_,c,D,y,K,B,N,E,h,v,J,q=t[9]&&pe(t),j=t[1]&&ce(t),P=(t[9]||t[1])&&de(),O=t[20]&&_e(t),F=t[12]&&t[11]>0&&be(t),M=t[4],A=[];for(let w=0;w<M.length;w+=1)A[w]=we(fe(t,M,w));return{c(){l=b("div"),e=b("div"),n=b("button"),n.textContent="Add Image directory",i=I(),f=b("button"),f.textContent="Update Person Database",s=I(),u=b("br"),r=I(),g=b("div"),p=b("div"),q&&q.c(),m=I(),j&&j.c(),_=I(),P&&P.c(),c=I(),D=b("input"),y=I(),O&&O.c(),K=I(),B=b("div"),N=b("div"),F&&F.c(),E=I(),h=b("div");for(let w=0;w<A.length;w+=1)A[w].c();d(n,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),d(f,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),d(e,"class","flex flex-row mt-10 place-content-center"),d(g,"class","flex flex-row place-content-center mb-10 select-none mx-2"),d(D,"type","file"),D.multiple=!0,Qe(D,"display","none"),d(D,"accept","image/png, image/jpeg, image/jpg"),d(B,"class","flex flex-row place-content-center mb-10 select-none mx-2"),d(h,"class","flex flex-wrap gap-6 p-4 sm:p-12 px-auto justify-center"),d(l,"class","overflow-y-auto min-h-screen bg-gray-600")},m(w,R){C(w,l,R),a(l,e),a(e,n),a(e,i),a(e,f),a(e,s),a(e,u),a(l,r),a(l,g),a(g,p),q&&q.m(p,null),a(p,m),j&&j.m(p,null),a(l,_),P&&P.m(l,null),a(l,c),a(l,D),t[36](D),a(l,y),O&&O.m(l,null),a(l,K),a(l,B),a(B,N),F&&F.m(N,null),a(l,E),a(l,h);for(let T=0;T<A.length;T+=1)A[T].m(h,null);v||(J=[U(n,"click",t[28]),U(f,"click",t[32]),U(D,"change",t[30])],v=!0)},p(w,R){if(w[9]?q?q.p(w,R):(q=pe(w),q.c(),q.m(p,m)):q&&(q.d(1),q=null),w[1]?j?j.p(w,R):(j=ce(w),j.c(),j.m(p,null)):j&&(j.d(1),j=null),w[9]||w[1]?P||(P=de(),P.c(),P.m(l,c)):P&&(P.d(1),P=null),w[20]?O?O.p(w,R):(O=_e(w),O.c(),O.m(l,K)):O&&(O.d(1),O=null),w[12]&&w[11]>0?F?F.p(w,R):(F=be(w),F.c(),F.m(N,null)):F&&(F.d(1),F=null),R[0]&48){M=w[4];let T;for(T=0;T<M.length;T+=1){const W=fe(w,M,T);A[T]?A[T].p(W,R):(A[T]=we(W),A[T].c(),A[T].m(h,null))}for(;T<A.length;T+=1)A[T].d(1);A.length=M.length}},i:ie,o:ie,d(w){w&&S(l),q&&q.d(),j&&j.d(),P&&P.d(),t[36](null),O&&O.d(),F&&F.d(),le(A,w),v=!1,H(J)}}}let We=100;const Ye="/api";async function Ze(t,l){let e=new FormData;e.append("mimetype",t.type),e.append("id",l),e.append("imagedata",t);const i=await fetch("/api/updateDatabase",{method:"POST",body:e});if(i.ok){const f=await i.json();alert(f.reason)}else throw new Error(i)}function xe(t,l,e){let n=[],i=[],f=[],s,u="",r=0,g,p,m,_=!1,c="0",D=!1,y=0,K=!0;function B(){const o=i.map((k,z)=>({i:z,value:i[z]}));o.sort((k,z)=>k.value>z.value?-1:k.value<z.value?1:0),i=o.map(k=>k.value),e(4,n=o.map(k=>n[k.i])),e(5,f=o.map(k=>f[k.i]))}let N=3;async function E(){let o=N;if(g=new FormData,!u)return;if(g.append("text_query",u),g.append("topk",o.toString()),r==0&&(e(4,n=[]),e(5,f=[]),i=[],g.append("query_start","true"),e(0,s.disabled=!0,s)),r==We){console.log("Max limit reached. Ending query."),r=0,e(0,s.disabled=!1,s);return}const k=Ye+"/search/image";let z=await fetch(k,{method:"POST",body:g});if(!z.ok)throw e(0,s.disabled=!1,s),new Error(z);let ee=z.body.getReader(),Ke=await new ReadableStream({start(ne){return se();function se(){return ee.read().then(({done:Me,value:Re})=>{if(Me){ne.close();return}return ne.enqueue(Re),se()})}}}),x=await(await new Response(Ke)).json();if(x.query_completed==!0){console.log("Stream completed"),r=0,e(0,s.disabled=!1,s);return}f.push(x.local_hash),n.push(x.data),i.push(Number(x.score)),B(),r+=1,E()}function h(o){o.key==="Enter"&&s.disabled==!1&&E()}let v;function J(){console.log("topk: ",N),E()}let q=[],j=!1,P,O=!1,F,M;async function A(){let o=await fetch("/api/faceIds");if(o.ok){let k=await o.json();e(15,q=k.face_ids.sort())}else throw new Error(o)}async function w(o){o.key==="@"?(e(16,j=!0),O=!1,await A(),M.focus(),e(17,P=q[0]),console.log("faces: ",q)):(o.key==="Enter"||o.key===" ")&&e(16,j=!1)}function R(){O||(e(6,u=u+P),O=!0),F.focus(),e(16,j=!1)}function T(o){o.key==="Enter"&&R(),(o.key==="Escape"||o.key==="Backspace")&&(e(16,j=!1),F.focus())}function W(){e(9,_=!0)}async function te(){let o=await fetch("/api/getIndexCount/image");if(o.ok){let k=await o.json();e(11,y=k.index_count)}else throw new Error(o)}async function ke(){console.log("adding image directory "+m),e(9,_=!1);let o=new FormData;o.append("image_directory_path",m);let k=await fetch("/api/indexImageDir",{method:"POST",body:o});if(k.ok)(await k.json()).success==!0&&(s&&e(0,s.disabled=!1,s),alert("Index Updated Successfully."),e(1,D=!1),await te());else throw new Error(k)}te();let ye=new EventSource("/api/imageIndexProgress");ye.onmessage=o=>{e(1,D=!0),console.log("Got some data: "+o.data);let k=o.data;e(10,c=k),c=="1"&&e(1,D=!1)};let Y=!1,Z,G,Q=[];function ve(){e(2,G=[]),e(3,Q=[]),e(2,G=this.files),console.log(G.length,"Files Selected");for(let o=0;o<G.length;o++){let k=G[o];console.log("mimetype: ",k.type),Q.push("")}e(20,Y=!0)}async function Ie(o){o.preventDefault();for(let k=0;k<G.length;k++){let z=Q[k],ee=G[k];if(z===""){alert("face ids cannot be empty");return}await Ze(ee,z)}e(20,Y=!1)}const Ce=()=>{Z.click()};function Se(o){X[o?"unshift":"push"](()=>{p=o,e(7,p)})}function De(){m=this.value,e(8,m)}const Ee=()=>{e(9,_=!1)};function qe(o){X[o?"unshift":"push"](()=>{Z=o,e(21,Z)})}function je(o){Q[o]=this.value,e(3,Q)}const Fe=()=>{e(20,Y=!1)};function Pe(o){X[o?"unshift":"push"](()=>{F=o,e(18,F)})}function Ue(){u=this.value,e(6,u)}function Oe(o){X[o?"unshift":"push"](()=>{s=o,e(0,s)})}function Te(){P=Xe(this),e(17,P)}function Ae(o){X[o?"unshift":"push"](()=>{M=o,e(19,M),e(15,q)})}function Ne(o){X[o?"unshift":"push"](()=>{v=o,e(14,v),e(0,s)})}function ze(){N=He(this.value),e(13,N)}return t.$$.update=()=>{t.$$.dirty[0]&2&&e(12,K=!D),t.$$.dirty[0]&1&&s&&e(14,v.disabled=s.disabled,v),t.$$.dirty[0]&12&&(console.log(G),console.log(Q))},[s,D,G,Q,n,f,u,p,m,_,c,y,K,N,v,q,j,P,F,M,Y,Z,E,h,J,w,R,T,W,ke,ve,Ie,Ce,Se,De,Ee,qe,je,Fe,Pe,Ue,Oe,Te,Ae,Ne,ze]}class $e extends Be{constructor(l){super(),Ge(this,l,xe,Je,Le,{},null,[-1,-1])}}new $e({target:document.getElementById("app")});
