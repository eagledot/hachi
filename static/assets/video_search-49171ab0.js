import{S as Q,i as T,s as N,H as X,e as m,a as U,D as Y,t as W,b as s,c as K,d as a,J as F,E as Z,l as B,m as V,y as $,A as ee,f as M,G as te,v as le,r as ne,h as z,x as G,P as ae}from"./DarkMode-9991abd2.js";function H(l,u,e){const t=l.slice();return t[18]=u[e],t[20]=e,t}function J(l){let u,e,t,d,r,i;return{c(){u=m("div"),e=m("a"),t=m("img"),i=U(),s(t,"class","sm:max-h-48 rounded-lg shadow-xl"),z(t.src,d=l[18])||s(t,"src",d),s(t,"alt","image"),s(e,"href",r="/api/get_full_image/"+l[2][l[20]]),s(e,"target","_blank"),s(u,"class","flex flex-col")},m(c,w){K(c,u,w),a(u,e),a(e,t),a(u,i)},p(c,w){w&2&&!z(t.src,d=c[18])&&s(t,"src",d),w&4&&r!==(r="/api/get_full_image/"+c[2][c[20]])&&s(e,"href",r)},d(c){c&&M(u)}}}function se(l){let u,e,t,d,r,i,c,w,k,S,j,L,E,x,q,g,R,C,A,o,p,h,I,v,D,O;k=new X({});let y=l[1],_=[];for(let n=0;n<y.length;n+=1)_[n]=J(H(l,y,n));return{c(){u=m("div"),e=m("div"),t=m("div"),d=m("div"),r=m("input"),i=U(),c=m("button"),c.textContent="Query All Videos",w=U(),Y(k.$$.fragment),S=U(),j=m("p"),L=W(l[4]),E=W(" Videos Indexed So far."),x=U(),q=m("div"),g=m("input"),R=U(),C=m("label"),A=W("Current Context Window: "),o=W(l[5]),p=U(),h=m("div"),I=m("div");for(let n=0;n<_.length;n+=1)_[n].c();s(r,"class","bg-transparent focus:outline-none dark:text-white border-b border-black dark:border-white"),s(r,"placeholder","Search"),s(c,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white px-3 py-1 ml-2 rounded-md"),s(d,"class","flex flex-row my-2"),s(j,"class","dark:dark:text-white"),s(g,"type","range"),s(g,"min","0"),s(g,"max","3"),s(g,"class","w-full"),s(C,"for","context_window"),s(C,"class","dark:text-white"),s(q,"class","my-4"),s(e,"class","flex flex-row place-content-center mt-10 select-none"),s(I,"class","relative grid md:grid-cols-3 2xl:grid-cols-5 gap-8 mt-6 grid-flow-row-dense"),s(h,"class","flex items-center select-none m-4"),s(u,"class","overflow-y-auto min-h-screen dark:bg-gray-600 dark:text-white")},m(n,b){K(n,u,b),a(u,e),a(e,t),a(t,d),a(d,r),F(r,l[3]),a(d,i),a(d,c),l[11](c),a(d,w),Z(k,d,null),a(t,S),a(t,j),a(j,L),a(j,E),a(t,x),a(t,q),a(q,g),l[12](g),F(g,l[5]),a(q,R),a(q,C),a(C,A),a(C,o),a(u,p),a(u,h),a(h,I);for(let f=0;f<_.length;f+=1)_[f].m(I,null);v=!0,D||(O=[B(r,"keyup",l[8]),B(r,"input",l[10]),B(c,"click",l[7]),B(g,"change",l[9]),B(g,"change",l[13]),B(g,"input",l[13])],D=!0)},p(n,[b]){if(b&8&&r.value!==n[3]&&F(r,n[3]),(!v||b&16)&&V(L,n[4]),b&32&&F(g,n[5]),(!v||b&32)&&V(o,n[5]),b&6){y=n[1];let f;for(f=0;f<y.length;f+=1){const P=H(n,y,f);_[f]?_[f].p(P,b):(_[f]=J(P),_[f].c(),_[f].m(I,null))}for(;f<_.length;f+=1)_[f].d(1);_.length=y.length}},i(n){v||($(k.$$.fragment,n),v=!0)},o(n){ee(k.$$.fragment,n),v=!1},d(n){n&&M(u),l[11](null),te(k),l[12](null),le(_,n),D=!1,ne(O)}}}const re="/api";async function ie(l,u){let t="/api/videoFramesBinaryData/"+l.split("_")[0]+"/"+u,r=await(await fetch(t)).blob(),i=null;return r.size>0&&(i=await URL.createObjectURL(r)),i}function oe(l,u,e){let t=[],d=[],r=[],i,c="",w=0;function k(){const o=d.map((p,h)=>({i:h,value:d[h]}));o.sort((p,h)=>p.value>h.value?-1:p.value<h.value?1:0),d=o.map(p=>p.value),e(1,t=o.map(p=>t[p.i])),e(2,r=o.map(p=>r[p.i]))}async function S(o="xxxxxxx",p=!1){let h=new FormData;h.append("text_query",c),h.append("context_window",E.toString()),p==!0&&h.append("data_generation_id",o),p==!1&&(e(1,t=[]),e(2,r=[]),d=[],h.append("query_start","true"),e(0,i.disabled=!0,i));const I=re+"/search_new/video";let v=await fetch(I,{method:"POST",body:h});if(!v.ok)throw e(0,i.disabled=!1,i),new Error(v);let D=await v.json();if(D.query_completed==!0){e(0,i.disabled=!1,i);return}let y=D.data_generation_id,_=D.local_hashes,n=D.scores;for(let b=0;b<n.length;b++){let f=await ie(_[b],y);f!=null&&(t.push(f),d.push(n[b]),r.push(_[b]),e(1,t))}k(),await S(y,!0)}function j(o){o.key==="Enter"&&i.disabled==!1&&S()}async function L(){let o=await fetch("/api/getIndexCount/video");if(o.ok){let p=await o.json();e(4,w=p.index_count)}else throw new Error(o)}let E=1,x;function q(){S()}L();function g(){c=this.value,e(3,c)}function R(o){G[o?"unshift":"push"](()=>{i=o,e(0,i)})}function C(o){G[o?"unshift":"push"](()=>{x=o,e(6,x),e(0,i)})}function A(){E=ae(this.value),e(5,E)}return l.$$.update=()=>{l.$$.dirty&1&&i&&e(6,x.disabled=i.disabled,x)},[i,t,r,c,w,E,x,S,j,q,g,R,C,A]}class ue extends Q{constructor(u){super(),T(this,u,oe,se,N,{})}}new ue({target:document.getElementById("app")});
