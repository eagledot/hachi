import{S as G,i as H,s as J,e as h,a as E,t as N,b as o,d as Q,f as r,I as T,l as j,m as U,n as V,g as X,v as L,r as Y,c as B,x as F,O as Z}from"./index-ad9718b8.js";function K(n,u,e){const t=n.slice();return t[19]=u[e],t[21]=e,t}function P(n){let u,e,t,i,m,a;return{c(){u=h("div"),e=h("a"),t=h("img"),a=E(),o(t,"class","h-auto rounded-lg shadow-xl"),B(t.src,i=n[19])||o(t,"src",i),o(t,"alt","image"),o(e,"href",m="/api/get_full_image/"+n[2][n[21]]),o(e,"target","_blank"),o(u,"class","flex flex-col")},m(p,g){Q(p,u,g),r(u,e),r(e,t),r(u,a)},p(p,g){g&2&&!B(t.src,i=p[19])&&o(t,"src",i),g&4&&m!==(m="/api/get_full_image/"+p[2][p[21]])&&o(e,"href",m)},d(p){p&&X(u)}}}function $(n){let u,e,t,i,m,a,p,g,v,C,A,S,R,y,f,k,q,W,O,D,I,s,d,w,x=n[1],_=[];for(let l=0;l<x.length;l+=1)_[l]=P(K(n,x,l));return{c(){u=h("div"),e=h("div"),t=h("div"),i=h("input"),m=E(),a=h("button"),a.textContent="Query All Videos",p=E(),g=h("br"),v=E(),C=h("p"),A=N(n[4]),S=N(" Videos Indexed So far."),R=E(),y=h("div"),f=h("input"),k=E(),q=h("label"),W=N("Current Context Window: "),O=N(n[5]),D=E(),I=h("div"),s=h("div");for(let l=0;l<_.length;l+=1)_[l].c();o(i,"class","bg-transparent focus:outline-none text-white border-b "),o(i,"placeholder","Search"),o(a,"class","bg-blue-600 hover:bg-blue-800 disabled:bg-blue-400 text-white py-1 px-3 m-2 rounded-md"),o(f,"type","range"),o(f,"min","0"),o(f,"max","3"),o(f,"class","w-full"),o(q,"for","context_window"),o(q,"class","text-white"),o(y,"class","my-4"),o(e,"class","flex flex-row place-content-center mt-10 select-none"),o(s,"class","relative grid md:grid-cols-3 2xl:grid-cols-4 gap-8 mt-6 grid-flow-row-dense"),o(I,"class","flex items-center select-none m-4"),o(u,"class","overflow-y-auto min-h-screen bg-gray-600")},m(l,b){Q(l,u,b),r(u,e),r(e,t),r(t,i),T(i,n[3]),r(t,m),r(t,a),n[11](a),r(t,p),r(t,g),r(t,v),r(t,C),r(C,A),r(C,S),r(t,R),r(t,y),r(y,f),n[12](f),T(f,n[5]),r(y,k),r(y,q),r(q,W),r(q,O),r(u,D),r(u,I),r(I,s);for(let c=0;c<_.length;c+=1)_[c].m(s,null);d||(w=[j(i,"keyup",n[8]),j(i,"input",n[10]),j(a,"click",n[7]),j(f,"change",n[9]),j(f,"change",n[13]),j(f,"input",n[13])],d=!0)},p(l,[b]){if(b&8&&i.value!==l[3]&&T(i,l[3]),b&16&&U(A,l[4]),b&32&&T(f,l[5]),b&32&&U(O,l[5]),b&6){x=l[1];let c;for(c=0;c<x.length;c+=1){const M=K(l,x,c);_[c]?_[c].p(M,b):(_[c]=P(M),_[c].c(),_[c].m(s,null))}for(;c<_.length;c+=1)_[c].d(1);_.length=x.length}},i:V,o:V,d(l){l&&X(u),n[11](null),n[12](null),L(_,l),d=!1,Y(w)}}}let ee=100;const te="/api";function ne(n,u,e){let t=[],i=[],m=[],a,p="",g=0,v,C=0;function A(){const s=i.map((d,w)=>({i:w,value:i[w]}));s.sort((d,w)=>d.value>w.value?-1:d.value<w.value?1:0),i=s.map(d=>d.value),e(1,t=s.map(d=>t[d.i])),e(2,m=s.map(d=>m[d.i]))}async function S(){if(v=new FormData,!p)return;if(v.append("text_query",p),v.append("context_window",f.toString()),g==0&&(e(1,t=[]),e(2,m=[]),i=[],v.append("query_start","true"),e(0,a.disabled=!0,a)),g==ee){console.log("Max limit reached. Ending query."),g=0,e(0,a.disabled=!1,a);return}const s=te+"/search/video";let d=await fetch(s,{method:"POST",body:v});if(!d.ok)throw e(0,a.disabled=!1,a),new Error(d);let w=d.body.getReader(),x=await new ReadableStream({start(b){return c();function c(){return w.read().then(({done:M,value:z})=>{if(M){b.close();return}return b.enqueue(z),c()})}}}),l=await(await new Response(x)).json();if(l.query_completed==!0){console.log("Stream completed"),g=0,e(0,a.disabled=!1,a);return}m.push(l.local_hash),t.push(l.data),i.push(Number(l.score)),A(),g+=1,S()}function R(s){s.key==="Enter"&&a.disabled==!1&&S()}async function y(){let s=await fetch("/api/getIndexCount/video");if(s.ok){let d=await s.json();e(4,C=d.index_count)}else throw new Error(s)}let f=1,k;function q(){S()}y();function W(){p=this.value,e(3,p)}function O(s){F[s?"unshift":"push"](()=>{a=s,e(0,a)})}function D(s){F[s?"unshift":"push"](()=>{k=s,e(6,k),e(0,a)})}function I(){f=Z(this.value),e(5,f)}return n.$$.update=()=>{n.$$.dirty&1&&a&&e(6,k.disabled=a.disabled,k)},[a,t,m,p,C,f,k,S,R,q,W,O,D,I]}class le extends G{constructor(u){super(),H(this,u,ne,$,J,{})}}new le({target:document.getElementById("app")});
