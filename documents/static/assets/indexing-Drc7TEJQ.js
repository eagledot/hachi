import{S as me,i as be,s as _e,a as he,c as xe,b,e as i,p as B,d as l,A as Z,w as $,m as ve,f as pe,g as t,q,x as fe,t as ye,h as Ie,j as ge,k as Se,v as we}from"./Sidebar-BJ_7uFPt.js";function ke(f){let v,u,e,n,y,E,C,Q,g,D,a,r,m,d,c,p,s,x,T,H,M,A,F,ee,j,N=(f[0].progress*100).toString().slice(0,4)+"",V,te,le,P,ne,U,W=f[0].details+"",X,ie,z,se,O,L,R,w,k,ae,G,de,I,oe,J,re,S,ue,K,_,Y,ce;return v=new he({}),{c(){xe(v.$$.fragment),u=b(),e=i("div"),n=i("div"),y=i("div"),E=i("div"),C=i("label"),C.textContent="Choose Documents to upload and Index (.pdf/.md/.html)",Q=b(),g=i("input"),a=b(),r=i("div"),r.innerHTML='<p class="mx-auto text-lg font-semibold">OR</p>',m=b(),d=i("p"),d.textContent="Press Start button to start indexing",c=b(),p=i("div"),s=i("input"),T=b(),H=i("div"),M=i("div"),A=i("div"),F=i("div"),ee=b(),j=i("div"),V=B(N),te=B("%"),le=b(),P=i("div"),ne=B("Details: "),U=i("span"),X=B(W),ie=b(),z=i("div"),z.innerHTML='<div class="mr-2 flex items-center"><input type="checkbox" class="h-5 w-5 text-blue-500"/> <label class="ml-1">Complete Rescan</label></div> <div class="text-sm text-gray-600">Re-index all originals, including already indexed and unchanged files.</div>',se=b(),O=i("div"),L=i("select"),R=i("option"),R.textContent="Html only",w=i("option"),w.textContent="Pdf Only",k=i("option"),k.textContent="Markdown Only",ae=b(),G=i("div"),G.textContent="Filter by content type",de=b(),I=i("button"),oe=B("Cancel"),re=b(),S=i("button"),ue=B("Start"),l(C,"class","rounded bg-blue-500 px-4 py-2 text-white hover:bg-blue-300 disabled:bg-blue-200"),l(C,"for","document_upload"),l(g,"id","document_upload"),l(g,"name","document_upload"),l(g,"type","file"),g.required=!0,g.multiple=!0,l(g,"accept",".pdf, .md, .html"),g.disabled=D=f[0].status=="loading",Z(g,"opacity","0"),l(y,"class","my-4"),l(r,"class","my-2"),l(d,"class","mb-2 text-sm font-semibold"),l(s,"id","uri_input"),s.disabled=x=f[0].status==="loading",l(s,"type","text"),l(s,"class","w-full rounded border p-1 text-sm"),l(s,"placeholder","D://images (Full path to directory to index)"),s.required=!0,l(p,"class","my-2"),l(F,"class","h-2 rounded bg-blue-500"),Z(F,"width",(f[0].progress*100).toString()+"%"),l(A,"class","flex h-2 w-11/12 rounded bg-gray-300"),l(j,"class","flex px-2 font-semibold"),l(M,"class","flex items-center"),l(U,"class","text-black"),l(P,"class","pt-1 text-sm text-blue-600"),l(H,"class","mb-3"),l(z,"class","mt-4 mb-3 flex flex-wrap items-center"),R.__value="Html only",$(R,R.__value),w.disabled=!0,w.__value="Pdf Only",$(w,w.__value),k.disabled=!0,k.__value="Markdown Only",$(k,k.__value),l(L,"class","h-8 rounded border border-blue-500 p-1 text-sm text-blue-700 focus:outline-none"),l(G,"class","ml-2 text-sm text-gray-600"),l(O,"class","mb-3 mt-3 flex flex-wrap items-center"),I.disabled=J=f[0].status==="done",l(I,"type","button"),l(I,"class","mr-2 mt-2 rounded bg-orange-500 px-4 py-2 text-white disabled:bg-orange-200 disabled:opacity-75"),S.disabled=K=f[0].status==="loading",l(S,"type","button"),l(S,"class","rounded bg-blue-500 px-4 py-2 text-white disabled:bg-blue-200"),l(n,"class","container mx-auto max-w-lg bg-green-50 p-4 mt-4"),l(e,"class","ml-64 h-screen bg-blue-200")},m(o,h){ve(v,o,h),pe(o,u,h),pe(o,e,h),t(e,n),t(n,y),t(y,E),t(E,C),t(E,Q),t(E,g),t(n,a),t(n,r),t(n,m),t(n,d),t(n,c),t(n,p),t(p,s),t(n,T),t(n,H),t(H,M),t(M,A),t(A,F),t(M,ee),t(M,j),t(j,V),t(j,te),t(H,le),t(H,P),t(P,ne),t(P,U),t(U,X),t(n,ie),t(n,z),t(n,se),t(n,O),t(O,L),t(L,R),t(L,w),t(L,k),t(O,ae),t(O,G),t(n,de),t(n,I),t(I,oe),t(n,re),t(n,S),t(S,ue),_=!0,Y||(ce=[q(g,"change",f[1]),q(s,"change",f[2]),q(s,"keyup",f[3]),q(I,"click",f[4]),q(S,"click",f[5])],Y=!0)},p(o,[h]){(!_||h&1&&D!==(D=o[0].status=="loading"))&&(g.disabled=D),(!_||h&1&&x!==(x=o[0].status==="loading"))&&(s.disabled=x),(!_||h&1)&&Z(F,"width",(o[0].progress*100).toString()+"%"),(!_||h&1)&&N!==(N=(o[0].progress*100).toString().slice(0,4)+"")&&fe(V,N),(!_||h&1)&&W!==(W=o[0].details+"")&&fe(X,W),(!_||h&1&&J!==(J=o[0].status==="done"))&&(I.disabled=J),(!_||h&1&&K!==(K=o[0].status==="loading"))&&(S.disabled=K)},i(o){_||(ye(v.$$.fragment,o),_=!0)},o(o){Ie(v.$$.fragment,o),_=!1},d(o){o&&(ge(u),ge(e)),Se(v,o),Y=!1,we(ce)}}}function Ee(f,v,u){const e={client_id:null,status:"done",uris:[],eta:1/0,progress:0,details:"No information...",beginIndexing(){if(this.uris){if(this.uris.length==0)return;let a=new FormData,r=this.uris.pop();if(a.append("uri",String(r)),!this.client_id){alert("Where is client id ???");return}a.append("client_id",this.client_id),this.status="loading",fetch("/api/beginIndex",{method:"POST",body:a}).then(m=>{m.json().then(d=>{let c=d[0],p=d[1];if(c===!1){alert(p);let s=document.getElementById("uri_input");s instanceof HTMLInputElement&&(s.value=""),this.status="done";return}else d[2].success==!0&&y(String(e.client_id))})})}else alert("Expected a valid URI.. bug probably")},cancelIndexing(a){let r=a.target;r instanceof HTMLButtonElement&&(r.disabled=!0),this.client_id?fetch("/api/endIndex/"+this.client_id).then(m=>{if(m.ok)m.json().then(d=>{let c=d[0],p=d[1];if(c==!1){alert("Error: "+String(p));return}if(d[2].cancellation_active==!1){alert("Error while cancelling..");return}});else{alert("Error Occured During indexing cancellation..!");return}}):alert("Client id expected. Bug...!")}};let n;window.onload=function(){if(u(0,e.status="loading",e),u(0,e.client_id=localStorage.getItem("docs_client_id"),e),!e.client_id){alert("Client Id is expected to be in localStorage. Treat this as a bug!");return}y(e.client_id)};function y(a){const r="/api/getIndexStatus/"+a;fetch(r).then(m=>{m.json().then(d=>{let c=d[0],p=d[1];if(c){let s=d[2];if(s.done===!1)u(0,e.eta=parseFloat(s.eta),e),u(0,e.progress=parseFloat(s.progress),e),u(0,e.details=s.details+" "+String(e.eta),e),n&&(clearTimeout(n),n=null),n=setTimeout(()=>{y(a)},1e3);else if(n&&(clearTimeout(n),n=null),e.uris.length>0)e.beginIndexing();else{u(0,e.status="done",e),u(0,e.details="",e),u(0,e.progress=0,e),u(0,e.eta=1/0,e);let T=document.getElementById("uri_input");T instanceof HTMLInputElement&&T.value&&(T.value=""),alert("Indexing Completed Successfully.")}}else p&&alert("Should not happen: "+String(p)),u(0,e.status="done",e)})})}return[e,a=>{if(e.status=="loading")return;let r=a.currentTarget,m=new FormData;if(r.files&&e.client_id){console.log(r.files[0]),m.append("client_id",e.client_id);let d=r.files.length;for(let c=0;c<d;c++){let p=r.files[c].name;m.append(p,r.files[c])}u(0,e.status="loading",e),fetch("/api/upload",{method:"POST",body:m}).then(c=>{c.json().then(p=>{let s=p[2].uris;for(let x=0;x<s.length;x++)e.uris.push(s[x]);e.beginIndexing()})})}else{alert("Expected files in input.. ERROR"),e.status=="done";return}},a=>{a.target instanceof HTMLInputElement?a.target.value&&(u(0,e.uris=[],e),e.uris.push(a.target.value)):alert("Expected Input Element. Bug !!!")},a=>{a.target instanceof HTMLInputElement&&a.keyCode===13&&e.beginIndexing()},a=>e.cancelIndexing(a),()=>e.beginIndexing()]}class Ce extends me{constructor(v){super(),be(this,v,Ee,ke,_e,{})}}new Ce({target:document.getElementById("app")});
